\chapter{Retry utility}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e}{}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e}\index{Retry utility@{Retry utility}}
\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md276}%
\Hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md276}%
 by \href{https://humanwhocodes.com}{\texttt{ Nicholas C. Zakas}}

If you find this useful, please consider supporting my work with a \href{https://humanwhocodes.com/donate}{\texttt{ donation}} or \href{https://stars.github.com/nominate/}{\texttt{ nominate me}} for a Git\+Hub Star.\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md277}{}\doxysection{\texorpdfstring{Description}{Description}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md277}
A utility for retrying failed async Java\+Script calls based on the error returned.\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md278}{}\doxysection{\texorpdfstring{Usage}{Usage}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md278}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md279}{}\doxysubsection{\texorpdfstring{Node.\+js}{Node.\+js}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md279}
Install using \href{https://npmjs.com/}{\texttt{ npm}} or \href{https://yarnpkg.com/}{\texttt{ yarn}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ @humanwhocodes/retry}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ or}
\DoxyCodeLine{}
\DoxyCodeLine{yarn\ add\ @humanwhocodes/retry}

\end{DoxyCode}


Import into your Node.\+js project\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ CommonJS}
\DoxyCodeLine{const\ \{\ Retrier\ \}\ =\ require("{}@humanwhocodes/retry"{});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ ESM}
\DoxyCodeLine{import\ \{\ Retrier\ \}\ from\ "{}@humanwhocodes/retry"{};}

\end{DoxyCode}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md280}{}\doxysubsection{\texorpdfstring{Deno}{Deno}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md280}
Install using \href{https://jsr.io}{\texttt{ JSR}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{deno\ add\ @humanwhocodes/retry}
\DoxyCodeLine{}
\DoxyCodeLine{\#or}
\DoxyCodeLine{}
\DoxyCodeLine{jsr\ add\ @humanwhocodes/retry}

\end{DoxyCode}


Then import into your Deno project\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ Retrier\ \}\ from\ "{}@humanwhocodes/retry"{};}

\end{DoxyCode}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md281}{}\doxysubsection{\texorpdfstring{Bun}{Bun}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md281}
Install using this command\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{bun\ add\ @humanwhocodes/retry}

\end{DoxyCode}


Import into your Bun project\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ Retrier\ \}\ from\ "{}@humanwhocodes/retry"{};}

\end{DoxyCode}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md282}{}\doxysubsection{\texorpdfstring{Browser}{Browser}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md282}
It\textquotesingle{}s recommended to import the minified version to save bandwidth\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ Retrier\ \}\ from\ "{}https://cdn.skypack.dev/@humanwhocodes/retry?min"{};}

\end{DoxyCode}


However, you can also import the unminified version for debugging purposes\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ Retrier\ \}\ from\ "{}https://cdn.skypack.dev/@humanwhocodes/retry"{};}

\end{DoxyCode}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md283}{}\doxysection{\texorpdfstring{API}{API}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md283}
After importing, create a new instance of {\ttfamily Retrier} and specify the function to run on the error. This function should return {\ttfamily true} if you want the call retried and {\ttfamily false} if not.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ this\ instance\ will\ retry\ if\ the\ specific\ error\ code\ is\ found}
\DoxyCodeLine{const\ retrier\ =\ new\ Retrier(error\ =>\ \{}
\DoxyCodeLine{\ \ \ \ return\ error.code\ ===\ "{}ENFILE"{}\ ||\ error.code\ ===\ "{}EMFILE"{};}
\DoxyCodeLine{\});}

\end{DoxyCode}


Then, call the {\ttfamily retry()} method around the function you\textquotesingle{}d like to retry, such as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ fs\ from\ "{}fs/promises"{};}
\DoxyCodeLine{}
\DoxyCodeLine{const\ retrier\ =\ new\ Retrier(error\ =>\ \{}
\DoxyCodeLine{\ \ \ \ return\ error.code\ ===\ "{}ENFILE"{}\ ||\ error.code\ ===\ "{}EMFILE"{};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{const\ text\ =\ await\ retrier.retry(()\ =>\ fs.readFile("{}README.md"{},\ "{}utf8"{}));}

\end{DoxyCode}


The {\ttfamily retry()} method will either pass through the result on success or wait and retry on failure. Any error that isn\textquotesingle{}t caught by the retrier is automatically rejected so the end result is a transparent passing through of both success and failure.\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md284}{}\doxysubsection{\texorpdfstring{Setting a Timeout}{Setting a Timeout}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md284}
You can control how long a task will attempt to retry before giving up by passing the {\ttfamily timeout} option to the {\ttfamily Retrier} constructor. By default, the timeout is one minute.


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ fs\ from\ "{}fs/promises"{};}
\DoxyCodeLine{}
\DoxyCodeLine{const\ retrier\ =\ new\ Retrier(error\ =>\ \{}
\DoxyCodeLine{\ \ \ \ return\ error.code\ ===\ "{}ENFILE"{}\ ||\ error.code\ ===\ "{}EMFILE"{};}
\DoxyCodeLine{\},\ \{\ timeout:\ 100\_000\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{const\ text\ =\ await\ retrier.retry(()\ =>\ fs.readFile("{}README.md"{},\ "{}utf8"{}));}

\end{DoxyCode}


When a call times out, it rejects the first error that was received from calling the function.\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md285}{}\doxysubsection{\texorpdfstring{Setting a Concurrency Limit}{Setting a Concurrency Limit}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md285}
When processing a large number of function calls, you can limit the number of concurrent function calls by passing the {\ttfamily concurrency} option to the {\ttfamily Retrier} constructor. By default, {\ttfamily concurrency} is 1000.


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ fs\ from\ "{}fs/promises"{};}
\DoxyCodeLine{}
\DoxyCodeLine{const\ retrier\ =\ new\ Retrier(error\ =>\ \{}
\DoxyCodeLine{\ \ \ \ return\ error.code\ ===\ "{}ENFILE"{}\ ||\ error.code\ ===\ "{}EMFILE"{};}
\DoxyCodeLine{\},\ \{\ concurrency:\ 100\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{const\ filenames\ =\ getFilenames();}
\DoxyCodeLine{const\ contents\ =\ await\ Promise.all(}
\DoxyCodeLine{\ \ \ \ filenames.map(filename\ =>\ retrier.retry(()\ =>\ fs.readFile(filename,\ "{}utf8"{}))}
\DoxyCodeLine{);}

\end{DoxyCode}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md286}{}\doxysubsection{\texorpdfstring{Aborting with {\ttfamily Abort\+Signal}}{Aborting with {\ttfamily Abort\+Signal}}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md286}
You can also pass an {\ttfamily Abort\+Signal} to cancel a retry\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ fs\ from\ "{}fs/promises"{};}
\DoxyCodeLine{}
\DoxyCodeLine{const\ controller\ =\ new\ AbortController();}
\DoxyCodeLine{const\ retrier\ =\ new\ Retrier(error\ =>\ \{}
\DoxyCodeLine{\ \ \ \ return\ error.code\ ===\ "{}ENFILE"{}\ ||\ error.code\ ===\ "{}EMFILE"{};}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{const\ text\ =\ await\ retrier.retry(}
\DoxyCodeLine{\ \ \ \ ()\ =>\ fs.readFile("{}README.md"{},\ "{}utf8"{}),}
\DoxyCodeLine{\ \ \ \ \{\ signal:\ controller.signal\ \}}
\DoxyCodeLine{);}

\end{DoxyCode}
\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md287}{}\doxysection{\texorpdfstring{Developer Setup}{Developer Setup}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md287}

\begin{DoxyEnumerate}
\item Fork the repository
\item Clone your fork
\item Run {\ttfamily npm install} to setup dependencies
\item Run {\ttfamily npm test} to run tests
\end{DoxyEnumerate}\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md288}{}\doxysubsection{\texorpdfstring{Debug Output}{Debug Output}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md288}
Enable debugging output by setting the {\ttfamily DEBUG} environment variable to {\ttfamily "{}@hwc/retry"{}} before running.\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md289}{}\doxysection{\texorpdfstring{License}{License}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md289}
Apache 2.\+0\hypertarget{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md290}{}\doxysection{\texorpdfstring{Prior Art}{Prior Art}}\label{md__project5___h_r_2_project5___h_r___front___end_2node__modules_2_0dhumanwhocodes_2retry_2_r_e_a_d_m_e_autotoc_md290}
This utility is inspired by, and contains code from \href{https://github.com/isaacs/node-graceful-fs}{\texttt{ {\ttfamily graceful-\/fs}}}. 